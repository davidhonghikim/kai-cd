# A1111 Service Documentation

This document provides a detailed overview of the integration between Kai-CD and the AUTOMATIC1111/stable-diffusion-webui.

-   **GitHub Repository:** [https://github.com/AUTOMATIC1111/stable-diffusion-webui](https://github.com/AUTOMATIC1111/stable-diffusion-webui)
-   **Official API Documentation:** [A1111 WebUI API Docs](https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/API)

## Capabilities

The A1111 integration currently supports the `image_generation` capability, which includes two modes:

1.  **Text-to-Image (`txt2img`):** Generate images from a text prompt.
2.  **Image-to-Image (`img2img`):** Generate a new image based on an initial image and a text prompt.

## Implemented Parameters

The following parameters are available in the UI for `txt2img` and `img2img` modes.

| Parameter | Type | Description |
| :--- | :--- | :--- |
| `prompt` | string | The main positive prompt. |
| `negative_prompt` | string | The negative prompt. |
| `sampler_name` | select | The sampling algorithm (e.g., `Euler a`). Loaded dynamically from the API. |
| `steps` | number | The number of denoising steps. |
| `cfg_scale` | number | CFG Scale, controlling how strictly the prompt is followed. |
| `width` / `height` | number | The dimensions of the output image. |
| `seed` | number | The random seed. `-1` for a random seed. |
| `sd_model_checkpoint`| select | The primary checkpoint model to use. Loaded dynamically. |
| `refiner_checkpoint`| select | **(SD-XL Only)** The refiner model for the second pass. Loaded dynamically. |
| `refiner_switch_at`| number | **(SD-XL Only)** The point to switch to the refiner (e.g., 0.8). |
| `enable_hr` | boolean | Toggles the High-Resolution Fix pass. |
| `denoising_strength`| number | The strength of the denoising process (for `img2img` and Hires. Fix). |
| `hr_scale` | number | The factor to upscale the image by in the Hires. Fix pass. |
| `hr_upscaler` | select | The upscaling algorithm to use for the Hires. Fix pass. Loaded dynamically. |
| `hr_second_pass_steps`| number | Number of steps for the Hires. Fix pass. `0` uses the original steps. |
| `init_image` | file | **(img2img Only)** The initial image to base the generation on. |

---

## Future Enhancements & API Limitations

The A1111 API is extremely powerful. This integration currently exposes the most common features, but there are plans and known limitations to be aware of.

### 1. Extra Networks (LoRA, Hypernetworks, etc.)

-   **Current Status:** The A1111 API can load additional networks like LoRAs and Hypernetworks by adding special syntax to the text prompt (e.g., `<lora:my_lora:0.8>`). The previous implementation in Kai-CD used a simple dropdown for LoRAs, which did not allow for multiple LoRAs or weight adjustments.
-   **Path Forward:**
    -   The old `lora` dropdown has been **removed** in favor of the native prompt-based method.
    -   The definition can now discover available LoRAs (`getLoras`) and Hypernetworks (`getHypernetworks`).
    -   A future UI enhancement is required to create a dedicated "Extra Networks Browser" component. This would allow a user to click on their available LoRAs, Hypernetworks, and Textual Inversion embeddings to easily insert them into the prompt with the correct syntax.

### 2. Clip Skip

-   **Limitation:** The A1111 API manages the "Clip Skip" feature via a special `override_settings` object in the request body, for example: `{"override_settings": {"CLIP_stop_at_last_layers": 2}}`.
-   **Path Forward:** The current Kai-CD `apiClient` only supports a flat key-value structure for parameters and cannot construct this nested JSON object. To properly support Clip Skip and other advanced settings, the `apiClient` needs to be refactored to handle more complex parameter-to-body mappings.

### 3. InstructPix2Pix

-   **Path Forward:** The `InstructPix2Pix` model uses a specific workflow that is distinct from standard `img2img`. This could be added in the future as a new, separate capability (e.g., `image_editing`) on the A1111 service definition to provide a dedicated UI for it. 